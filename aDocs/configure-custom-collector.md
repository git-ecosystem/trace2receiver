# Configure a Custom Collector

The custom collector requires a `config.yml` file to specify
which (of the linked-in) components should be initialized,
how data should flow between them, and how they should be
individually configured.

[Collector Configuration](https://opentelemetry.io/docs/collector/configuration/)
describes the concepts and `config.yml` file format.

## Adding `trace2receiver` to `config.yml`

To use the `trace2receiver` component the following sections must be
present in the `config.yml` file.  The first section tells the custom
collector framework to initialize the component.  This is conceptually
like causing the component's constructor function to be called when
the collector boots up.  The second section puts the receiver
component into a
[pipeline](https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/design.md#pipelines)
with one or more other components so that the OTEL telemetry data
generated by the `trace2receiver` component actually goes somewhere.

```
receivers:
  trace2receiver:
    <trace2receiver-specific-config-values>

...

service:
  pipelines:
    traces:
      receivers: [trace2receiver]
      processors: []
      exporters: [<destination>, logging]
```

## `trace2receiver` Specific Config Values

The `trace2receiver` component has the following config values:

```
receivers:
  trace2receiver:
    socket: <unix-domain-socket-pathname>
    pipe:   <windows-named-pipe-pathname>
    pii:    <pii-settings-pathname>
    filter: <filter-settings-pathname>
```

For example:

```
receivers:
  trace2receiver:
    socket: "/usr/local/my-collector/trace2.socket"
    pipe:   "//./pipe/my-collector.pipe"
    pii:    "/usr/local/my-collector/pii.yml"
    filter: "/usr/local/my-collector/filter.yml"
```

### `<unix-domain-socket-pathname>` (Required on Unix)

The pathname will be used on Linux and macOS hosts to create a Unix
Domain Socket where the receiver will listen for telemetry from Git
commands.  The socket will be created when the collector starts up.

To tell Git to send Trace2 telemetry to the receiver, you must set
the Git `trace2.eventtarget` config setting at the `global` or
`system` level to this socket pathname.  See the Git Trace2 API
documentation on the
[event format target](https://git-scm.com/docs/api-trace2#_the_event_format_target)
and
[enabling a target](https://git-scm.com/docs/api-trace2#_enabling_a_target)
for details.

```
$ git config --system trace2.eventtarget "af_unix:/usr/local/my-collector/trace2.socket"
```

_The `af_unix:` prefix is required to tell Git that it should expect a
Unix Domain Socket rather than a plain file._

### `<windows-named-pipe-pathname>` (Required on Windows)

The pathname will be used on Windows hosts to create a Windows Named
Pipe where the receiver will listen for telemetry from Git commands.
This named pipe will be created when the collector starts up.  This
pathname must refer to a local named pipe `//./pipe/...` because named
pipe servers can only create and listen on local pipes.  You may use
forward or backslashes.

To tell Git to send Trace2 telemetry to the receiver, you must set
the Git `trace2.eventtarget` config setting at the `global` or
`system` level to this named pipe pathname.  See the Git Trace2 API
documentation on the
[event format target](https://git-scm.com/docs/api-trace2#_the_event_format_target)
and
[enabling a target](https://git-scm.com/docs/api-trace2#_enabling_a_target)
for details.

```
$ git config --system trace2.eventtarget "//./pipe/my-collector.pipe"
```

### `<pii-settings-pathname>` (Optional)

The pathname to a `pii.yml` file containing privacy-related feature flags.
This is optional.  These features are disabled by default.

See [config PII settings](./config-pii-settings.md) for details.

### `<filter-settings-pathname>` (Optional)

The pathname to a `filter.yml` file controlling the verbosity of the
generated OTEL telemetry data.  This is optional.  If omitted,
summary-level telemetry will be emitted.

See [config filter settings](./config-filter-settings.md) for details.
